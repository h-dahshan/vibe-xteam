# Feature 2: Teams Module (Leaders Only)

## 1. Feature Summary

The Teams Module is accessible only when a user is operating under the **Leader profile**.  
It allows Leaders to create, update, delete, and list teams, and to add Mates via a secure, one-time-use connection code generated by the Mate.

---

## 2. Personas

### Leader

- Has permission to create and manage teams.
- Can add or remove Mates from teams.
- Can own multiple teams.

### Mate

- Can generate a one-time-use code for joining a Leader’s team.
- Cannot view or manage teams unless in Leader profile.

---

## 3. Journey Explanations

### Team Creation (Leader)

1. Leader navigates to Teams section.
2. Clicks “Create Team” and enters name/description.
3. Team is saved and listed in Leader’s dashboard.

### Adding Mates to Teams

1. Mate (in Mate profile) generates a one-time-use join code.
2. Leader enters the code in “Add Mate” form inside a team.
3. System validates code.
4. If valid, Mate is added to the team and code becomes invalid.

---

## 4. Journey Validations

- Leader can create/update/delete teams they own.
- Leader can view only their own teams.
- Mate’s code can only be used once.
- Expired or invalid codes show a clear error message.
- System prevents adding the same Mate twice to the same team.

---

## 5. Dependencies & Constraints

### Dependencies

- Users & Auth module.
- Code generation and validation service.
- DB Tables: `teams`, `team_members`, `join_codes`, `audit_logs`.

### Constraints

- Only team owners can modify team details.
- Code must expire after a set time (default: 24 hours).

---

## 6. Open Questions (_Future Scope_)

- Should Mates approve joining before being added?
- Should we allow team transfer to another Leader?
- Should Leaders have an upper limit of teams they can own?
- Should teams have upper limit of members they can have?

---

## 7. Functional Requirements

### Team Management

#### FR1: Leader can create new teams

##### FR1: Preconditions

- Active profile = Leader.

##### FR1: Main Path

1. Leader clicks “Create Team.”
2. Enters name/description.
3. System stores team in `teams` tabke.

##### FR1: Alternative Paths

- Missing fields => Validation error.

##### FR1: Postconditions

- New team appears in Leader’s team list.

---

#### FR2: Leader can update team name/description

##### FR2: Preconditions

- Leader owns the team.

##### FR2: Main Path

1. Leader opens team settings.
2. Updates details.
3. System saves changes in `teams` table.

##### FR2: Alternative Paths

- Unauthorized => “Not team owner.”

##### FR2: Postconditions

- Team details updated.

---

#### FR3: Leader can delete teams they own

##### FR3: Preconditions

- Leader owns the team.

##### FR3: Main Path

1. Leader clicks delete.
2. Confirms action.
3. System removes team from `teams` table and related entries from `team_members`.

##### FR3: Alternative Paths

- Unauthorized => “Not team owner.”

##### FR3: Postconditions

- Team no longer visible.

---

#### FR4: Leader can list all owned teams

##### FR4: Preconditions

- Active profile = Leader.

##### FR4: Main Path

1. Leader navigates to Teams.
2. System fetches all teams from `teams` table owned by the Leader.

##### FR4: Alternative Paths

- No teams found → Return empty list.

##### FR4: Postconditions

- List displayed in UI.

---

### Mate Addition via Code

#### FR5: Mate can generate a one-time-use join code

##### FR5: Preconditions

- Active profile = Mate.

##### FR5: Main Path

1. Mate clicks “Generate Code.”
2. System creates record in `join_codes` table with expiry.

##### FR5: Alternative Paths

- Already has active code => “Code already active.”

##### FR5: Postconditions

- Code ready for Leader.

---

#### FR6: Leader can input a Mate’s code to add them to a team

##### FR6: Preconditions

- Leader owns the team.
- Mate has generated a code.

##### FR6: Main Path

1. Leader enters code.
2. System validates in `join_codes` table.
3. Adds Mate to `team_members` table.
4. Invalidates code.

##### FR6: Alternative Paths

- Expired code => “Code expired.”
- Invalid code => “Invalid code.”
- Mate already in team => “Already a member.”

##### FR6: Postconditions

- Mate appears in team member list.
- System invalidates the code after successful use

---

#### FR7: Leader can list all joined teams

##### FR7: Preconditions

- Active profile = Mate.

##### FR7: Main Path

1. Mate navigates to Teams.
2. System fetches from `team_members` joined with `teams` where the Mate is member at

##### FR7: Alternative Paths

- No teams found → Return empty list.

##### FR7: Postconditions

- List displayed in UI.

---

## 8. Non-Functional Requirements

---

## 9. Audit Logging

- Log every action in `audit_logs`.

## 10. Data Model

### `teams`

| Field       | Type        | Notes                          |
| ----------- | ----------- | ------------------------------ |
| id          | UUID (PK)   |                                |
| leader_id   | UUID (FK)   | References `users.id` (Leader) |
| name        | string(100) | Required                       |
| description | text        | Optional                       |
| created_at  | datetime    |                                |
| updated_at  | datetime    |                                |
| is_deleted  | boolean     |                                |

### `team_members`

| Field     | Type                | Notes                        |
| --------- | ------------------- | ---------------------------- |
| team_id   | UUID (FK)           |                              |
| mate_id   | UUID (FK)           | References `users.id` (Mate) |
| role      | enum(MEMBER, ADMIN) | Default = member             |
| joined_at | datetime            |                              |

### `mate_join_codes`

| Field      | Type       | Notes                        |
| ---------- | ---------- | ---------------------------- |
| code       | string(12) | Unique                       |
| mate_id    | UUID (FK)  | References `users.id` (Mate) |
| expires_at | datetime   | One-time use                 |
| used_at    | datetime   | Nullable                     |

---

## 11. API Endpoints

- `GET /teams`
- `POST /teams`
- `PATCH /teams/:id`
- `DELETE /teams/:id`
- `POST /join-codes` (Mate)
- `POST /teams/:id/add-mate` (Leader)

---
